
<div class="strib-styles ssa ssb ssc">
  <div class="container-lg">
    <div class="hero">
      <h1>Vaccinations rates in Minnesota</h1>

      <!-- <p class="lead container-sm"></p> -->

      <div class="byline">
        <address>By
          <a rel="author" href="http://startribune.com/maryjo-webster/440928273/">Alan Palazzolo</a>
          and
          <a rel="author" href="http://startribune.com/maryjo-webster/303594441/">MaryJo Webster</a>
        </address>
        <span class="spacer"></span>
        Star Tribune
        <span class="spacer-alt"></span>
        <time pubdate datetime="2019-02-14T10:00:00">February 14, 2019</time>
      </div>

      <div class="share-placeholder">
        <!-- share -->
      </div>
    </div>
  </div>

  <div class="container-copy bottom-space-extra">
    <p>There are hundreds of private and public schools in Minnesota that are potential "pockets" for measles outbreaks, according to a Star Tribune data analysis.</p>

    <p>Among public and private schools serving kindergartners that reported vaccination data to the Minnesota Department of Health last year, about 30 percent would qualify as one of these "pockets" because less than 90 percent of the students were identified as having received both doses of the measles-mumps-rubella (MMR) vaccine before starting school.</p>

    <p>Among schools serving seventh-graders, about 13 percent reported having less than 90 percent vaccinated.</p>

    <p><em>Chart 1</em></p>

    <p>Experts say a vaccination rate of at least 95 percent is needed to protect individuals who cannot get the vaccine for medical reasons.</p>

    <p>These pockets are more common among charter schools and private schools, particularly those with small enrollments.</p>

    <p><em>Chart 2</em></p>

    <p>Minnesota is one of 18 states that allow a non-medical personal exemption, which accounts for about three percent of kindergartners who are not vaccinated and two percent of seventh graders last year. These non-medical exemptions are more common in private and charter schools. </p>

    <p><em>Chart 3</em></p>

    <p>The majority of schools identified as "pockets" have low vaccination rates largely due to students who have only received one of the two doses of MMR or because the school doesn't have the necessary paperwork either proving the students are fully vaccinated or that they have non-medical or medical waivers.</p>

    <p>Among the state√≠s currently licensed 1,700 child care centers, there are about 130 that have measles vaccination rates below 90 percent, including some as low as 30 percent. There are also about 300 facilities that did not report in 2017-18, the most recent year of data available.</p>

    <p>Use the search tools below to find vaccination rates for child care centers and private and public schools serving kindergartners and seventh graders throughout Minnesota.</p>
  </div>

  <div class="place-search-form container-copy">
    <div class="row">
      <div class="col col-100 col-md-60">
        <h3>Search for a location</h3>

        <form class="form-compact" on:submit="handleSearch(event)">
          <div class="form-item form-item-input">
            <label class="sr-only" for="place-search">Search for a location</label>

            <input type="search" ref:placeSelect  id="place-search" bind:value="placeSearch"  placeholder="{ loadingLocations ? 'Loading data...' : 'Enter search terms' }" aria-describedby="place-search-help" disabled="{ loadingLocations }">

            <small id="place-search-help">
              Type in name, city, or district keywords to search for a child care center or kindergarten in Minnesota.
            </small>
          </div>

          <div class="form-item">
            <button type="submit" on:click="handleSearch(event)" disabled="{ loadingLocations }">Search</button>
          </div>
        <form>
      </div>

      <div class="col col-100 col-md-40 location-lists">
        <aside>
          <!-- <h3 class="label">Notable locations</h3> -->

          <ul class="cf">
            {#each Object.entries(locationLists) as [li, l]}
              <li><a href="#/{ li }" class="{ locationList === li ? 'active' : ''}" on:click="specificList(l, li, event)">{@html l.title }</li>
            {/each}
          </ul>
        </aside>
      </div>
    </div>
  </div>

  <div class="container-lg">
    {#if loadingLocations}
      <p class="loading-lcoations search-note">
        Loading kindergartens and child care center data for searching...
      </p>
    {:elseif noResults}
      <p class="no-results search-note">
        Your search did not find any results.
      </p>
    {:elseif searchResults && searchResults.length}
      <div class="locations">
        {#each searchResults as r, i (r.id)}
          <Location
            {...r}
            stats="{ stats }"
          />
        {/each}
      </div>

      {#if moreResults}
        <div class="more-results search-note">
          <p>There are more results for the search "{ placeSearch }"; trying making your search more specific to find more exact  location.</p>
        </div>
      {/if}
    {:else}
      <p class="no-searching search-note">
        Use the search above to search for a child care center or kindergarten in Minnesota.
      </p>
    {/if}
  </div>

  <div class="container-copy">
    <footer class="article-footer">
      <p>Data for <a href="http://www.health.state.mn.us/divs/idepc/immunize/stats/school/index.html" target="_blank" rel="noopener">vaccination rates in public and private schools</a> and <a href="http://www.health.state.mn.us/divs/idepc/immunize/stats/childcare/index.html" target="_blank" rel="noopener">child care centers</a> for the 2017-2018 school year provided by the Minnesota Department of Health.</p>

      <ul>
        <li>To protect privacy, schools and school districts with kindergarten enrollment of fewer than 5 children have their data redacted.</li>
        <li>&dagger; "Partially vaccinated or no doses" includes students who are in the process of completing a vaccine series, have not been vaccinated and do not have an exemption on file, or who did not submit vaccine records to their school health staff.</li>
        <li>&Dagger; "No doses" includes students who have not been vaccinated and do not have an exemption on file, or who did not submit vaccine records to their school health staff.</li>
      </ul>
    </footer>
  </div>
</div>

<script>
  import Location from "./shared/_location.svelte.html";
  import Chart from "./shared/charts/_chart.svelte.html";
  import lunr from "lunr";
  import { find, sort, orderBy, take, filter } from "lodash";

  export default {
    components: {
      Location,
      Chart
    },

    oncreate() {
      let { locations } = this.get();

      // For content that lives in the CMS directly, we hack
      // around the share bits by removing it before we load
      // the component, then re-attach here.
      if (this.get().attachShare) {
        this.get().attachShare();
      }

      // If we have locations
      this.set({
        loadingLocations: !(locations && locations.length)
      });

      // Create search index
      let index = lunr(function() {
        this.ref("id");
        this.field("name");
        this.field("city");
        this.field("district");

        locations.forEach(l => {
          this.add(l);
        });
      });

      // Attach (no reason to watch any changes)
      this.__searchIndex = index;
    },

    methods: {
      handleSearch(event) {
        if (event && event.preventDefault) {
          event.preventDefault();
        }

        if (this.get().placeSearch) {
          this.search(this.get().placeSearch);
        }
      },

      search(terms) {
        if (!terms) {
          return;
        }

        // Values we need
        let { searchResultsLimit, locations } = this.get();

        // Search
        let results = this.__searchIndex.search(terms);

        // If no results
        if (!results || !results.length) {
          this.set({ noResults: true });
          return;
        }

        // Get results
        let found = [];
        results.forEach((r, ri) => {
          if (ri < searchResultsLimit) {
            let f = find(locations, { id: r.ref });

            if (f) {
              found.push(f);
            }
          }
        });

        this.set({
          searchResults: found,
          moreResults: results.length > searchResultsLimit,
          locationList: undefined
        });
      },

      specificList(list, listId, event) {
        if (event && event.preventDefault) {
          event.preventDefault();
        }

        let { locations } = this.get();
        this.resetSearch();
        this.set({ locationList: listId });

        let filtered = filter(locations, list.filter);
        if (list.sort) {
          filtered = orderBy(
            filtered,
            list.sort.map(s => s[0]),
            list.sort.map(s => s[1])
          );
        }

        if (list.limit) {
          filtered = take(filtered, list.limit);
        }

        this.set({
          searchResults: filtered
        });
      },

      resetSearch() {
        this.set({
          placeSearch: "",
          searchResults: [],
          moreResults: false,
          noResults: false,
          locationList: undefined
        });
      }
    },

    data() {
      return {
        isBrowser: typeof window !== "undefined",
        loadingLocations: true,
        placeSearch: "",
        searchResultsLimit: 20,
        searchResults: [],
        moreResults: false,
        noResults: false,
        locationLists: {
          "lowest-child-care-centers": {
            title:
              'Child care centers with the lowest <abbr title="Measles, Mumps, and Rubella">MMR</abbr> rates',
            filter: l => l.type === "child-care-centers" && !l.exclusion,
            sort: [[l => l.mmrVac, "asc"], [l => l.name, "asc"]],
            limit: 20
          },
          "lowest-kindergartens": {
            title:
              'Kindergartens with the lowest <abbr title="Measles, Mumps, and Rubella">MMR</abbr> rates',
            filter: l => l.type === "kindergarten" && !l.exclusion,
            sort: [[l => l.mmrVac, "asc"], [l => l.name, "asc"]],
            limit: 20
          },
          "highest-enrollment-child-care-centers": {
            title: "Child care centers with the highest enrollment",
            filter: l => l.type === "child-care-centers" && !l.exclusion,
            sort: [[l => l.enrollment, "desc"], [l => l.name, "asc"]],
            limit: 20
          },
          "highest-enrollment-kindergartens": {
            title: "Kindergartens with the highest enrollment",
            filter: l => l.type === "kindergarten" && !l.exclusion,
            sort: [[l => l.enrollment, "desc"], [l => l.name, "asc"]],
            limit: 20
          }
        },
        charts: {
          lowMmr: [
            {
              x: "Kindergarten",
              groups: [
                {
                  x: 2013,
                  y: 0.22
                },
                {
                  x: 2018,
                  y: 0.295
                }
              ]
            },
            {
              x: "7th grade",
              groups: [
                {
                  x: 2013,
                  y: 0.09
                },
                {
                  x: 2018,
                  y: 0.134
                }
              ]
            }
          ]
        }
      };
    }
  };
</script>
